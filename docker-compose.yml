services:
  # Backend Django
  backend:
    build: ./backend
    container_name: mapa-backend
    ports:
      - "8000:8000"
    volumes:
      - ./backend:/app
      - ./backend/.secrets:/app/.secrets
    environment:
      - PYTHONUNBUFFERED=1
    networks:
      - mapa-network
    restart: unless-stopped

  # Frontend React
  frontend:
    build: ./frontend
    container_name: mapa-frontend
    ports:
      - "5173:5173"
    volumes:
      - ./frontend:/app
      - /app/node_modules
    environment:
      - VITE_API_URL=http://localhost:8000/api
    networks:
      - mapa-network
    restart: unless-stopped
    depends_on:
      - backend

  # Cloudflare Tunnel - Desabilitado para desenvolvimento local
  # cloudflared-backend:
  #   image: cloudflare/cloudflared:latest
  #   container_name: mapa-cloudflared-backend
  #   command: tunnel --no-autoupdate --url http://backend:8000
  #   networks:
  #     - mapa-network
  #   depends_on:
  #     - backend
  #   restart: unless-stopped

  # cloudflared-frontend:
  #   image: cloudflare/cloudflared:latest
  #   container_name: mapa-cloudflared-frontend
  #   command: tunnel --no-autoupdate --url http://frontend:5173
  #   networks:
  #     - mapa-network
  #   depends_on:
  #     - frontend
  #   restart: unless-stopped

networks:
  mapa-network:
    driver: bridge
